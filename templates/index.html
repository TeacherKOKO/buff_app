<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <title>バフ計算ツール</title>
    <style>
        body {
            background: linear-gradient(to bottom, #cce0ff, #ffffff);
            color: #333;
            font-family: sans-serif;
            position: relative;
            overflow: hidden;
        }
        .win { color: green; }
        .lose { color: red; }
        ul { list-style: none; padding: 0; }
        li { margin-bottom: 5px; }
        .snowflake {
            position: absolute;
            top: -10px;
            color: #fff;
            font-size: 1.2em;
            animation: fall linear infinite;
        }
        @keyframes fall {
            to {
                transform: translateY(100vh);
            }
        }
    </style>
</head>
<body>
    <h1>❄️ バフ比較計算ツール ❄️</h1>

    <form method="post">
        <h2>味方の兵数</h2>
        <ul>
            {% for i in range(9) %}
            <li>{{ unit_labels[i] }}: <input type="number" name="u{{ i+1 }}" min="0"></li>
            {% endfor %}
        </ul>

        <h2>敵の兵数</h2>
        <ul>
            {% for i in range(9) %}
            <li>{{ unit_labels[i] }}: <input type="number" name="v{{ i+1 }}" min="0"></li>
            {% endfor %}
        </ul>

        <h2>味方バフ</h2>
        <ul>
            {% for i in range(12) %}
            <li>{{ buff_labels[i] }}: <input type="number" step="0.1" name="{{ buff_vars[i] }}"></li>
            {% endfor %}
        </ul>

        <h2>敵バフ</h2>
        <ul>
            {% for i in range(12) %}
            <li>{{ buff_labels[i] }}: <input type="number" step="0.1" name="{{ buff_vars[i+12] }}"></li>
            {% endfor %}
        </ul>

        <button type="submit">計算！</button>
    </form>

    {% if results %}
        <h2>🔎 結果</h2>
        <p>味方総計: <strong>{{ results.total_w | round(1) }}</strong></p>
        <p>敵総計: <strong>{{ results.total_x | round(1) }}</strong></p>

        <ul>
            {% for i in range(36) %}
            <li class="{{ 'win' if results.w[i] > results.x[i] else 'lose' }}">
                味方: {{ results.w[i]|round(1) }} vs 敵: {{ results.x[i]|round(1) }}
            </li>
            {% endfor %}
        </ul>

        <pre>{{ results.message }}</pre>
    {% endif %}

    <!-- 雪アニメーション -->
    <script>
        for (let i = 0; i < 50; i++) {
            let snow = document.createElement("div");
            snow.className = "snowflake";
            snow.style.left = Math.random() * 100 + "vw";
            snow.style.animationDuration = 5 + Math.random() * 5 + "s";
            snow.style.opacity = Math.random();
            snow.textContent = "❄️";
            document.body.appendChild(snow);
        }
    </script>
</body>
</html>